<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>バーサスリヴァイズ設定判別</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 2rem auto; padding: 1rem; }
    h1 { font-size: 1.5rem; margin-bottom: 1rem; }
    label { display: block; margin-top: 1rem; }
    input[type="number"] { width: 100px; margin-right: 10px; }
    button { margin-top: 1rem; }
    .result { margin-top: 2rem; font-weight: bold; }
  </style>
</head>
<body>
  <h1>バーサスリヴァイズ設定判別</h1>
  <form id="judgeForm">
    <label>① 総ゲーム数: <input type="number" id="games" /></label>
    <label>BIG回数: <input type="number" id="big" /></label>
    <label>REG回数: <input type="number" id="reg" /></label>
    <label>ベルA: <input type="number" id="bellA" /></label>
    <label>ベルB: <input type="number" id="bellB" /></label>
    <label>スイカA: <input type="number" id="suikaA" /></label>
    <label>チェリーB: <input type="number" id="cherryB" /></label>

    <label>BIG中：角チェ+ベル: <input type="number" id="cb_bell" /> / <input type="number" id="cb_bell_total" placeholder="母集団" /></label>
    <label>BIG中：角チェ: <input type="number" id="cb" /> / <input type="number" id="cb_total" placeholder="母集団" /></label>
    <label>BIG中：中段チェリー: <input type="number" id="middle" /> / <input type="number" id="middle_total" placeholder="母集団" /></label>

    <label>REG中：一枚役: <input type="number" id="reg1" /> / <input type="number" id="reg_total" placeholder="母集団" /></label>
    <label>REG中：ハズレ: <input type="number" id="reg_hz" /> / <input type="number" id="reg_total2" placeholder="母集団" /></label>

    <label>チャレンジ中：通常リプ: <input type="number" id="vsc_rip" /> / <input type="number" id="vsc_total" placeholder="母集団" /></label>
    <label>チャレンジ中：ハズレ: <input type="number" id="vsc_hz" /> / <input type="number" id="vsc_total2" placeholder="母集団" /></label>

    <label>ゲーム中：RTリプ: <input type="number" id="vsg_rip" /> / <input type="number" id="vsg_total" placeholder="母集団" /></label>
    <label>ゲーム中：ハズレ: <input type="number" id="vsg_hz" /> / <input type="number" id="vsg_total2" placeholder="母集団" /></label>

    <button type="button" onclick="judge()">判別する</button>
  </form>
  <div class="result" id="result"></div>

  <script>
    const settings = [1, 2, 5, 6];
    const rates = {
      big: [1/292.6, 1/284.9, 1/275.4, 1/264.3],
      reg: [1/374.5, 1/341.3, 1/319.7, 1/292.6],
      bellA: [1/10.9, 1/10.7, 1/10.5, 1/10.2],
      bellB: [1/20.9, 1/21.2, 1/20.3, 1/20.6],
      suikaA: [1/74.5, 1/70.6, 1/72.5, 1/68.8],
      cherryB: [1/56.2, 1/57.7, 1/53.1, 1/54.4],
      cb_bell: [1/256, 1/128, 1/256, 1/128],
      cb: [1/256, 1/128, 1/256, 1/128],
      middle: [1/16384, 1/16384, 1/16384, 1/897.8],
      reg1: [1/8, 1/8, 1/7, 1/7],
      reg_hz: [0, 0, 1/376.6, 1/376.6],
      vsc_rip: [1/3, 1/3.1, 1/3.3, 1/3.4],
      vsc_hz: [1/5, 1/4.9, 1/4.6, 1/4.5],
      vsg_rip: [1/1.7, 1/1.8, 1/1.8, 1/1.8],
      vsg_hz: [1/10.1, 1/9.4, 1/8.7, 1/8.1]
    };

    function logLikelihood(k, n, p) {
      if (n === 0 || isNaN(k) || isNaN(n)) return 0;
      if (p === 0 || p === 1) return -Infinity;
      return k * Math.log(p) + (n - k) * Math.log(1 - p);
    }

    function judge() {
      const resultDiv = document.getElementById('result');
      const inputs = [
        ['big', 'games'], ['reg', 'games'], ['bellA', 'games'], ['bellB', 'games'],
        ['suikaA', 'games'], ['cherryB', 'games'],
        ['cb_bell', 'cb_bell_total'], ['cb', 'cb_total'], ['middle', 'middle_total'],
        ['reg1', 'reg_total'], ['reg_hz', 'reg_total2'],
        ['vsc_rip', 'vsc_total'], ['vsc_hz', 'vsc_total2'],
        ['vsg_rip', 'vsg_total'], ['vsg_hz', 'vsg_total2']
      ];

      let logLs = settings.map(_ => 0);

      inputs.forEach(([key, totalId]) => {
        const val = parseInt(document.getElementById(key)?.value);
        const total = parseInt(document.getElementById(totalId)?.value);
        if (!isNaN(val) && !isNaN(total)) {
          settings.forEach((s, i) => {
            logLs[i] += logLikelihood(val, total, rates[key][i]);
          });
        }
      });

      const maxLog = Math.max(...logLs);
      const probs = logLs.map(l => Math.exp(l - maxLog));
      const sumProb = probs.reduce((a, b) => a + b, 0);
      const percents = probs.map(p => (p / sumProb * 100).toFixed(2));

      resultDiv.innerHTML = '<h3>判別結果</h3><ul>' + settings.map((s, i) =>
        `<li>設定${s}: ${percents[i]}%</li>`
      ).join('') + '</ul>';
    }
  </script>
</body>
</html>
