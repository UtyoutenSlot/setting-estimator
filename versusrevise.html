<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>設定判別 入力画面</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      background-color: #f2f2f2;
    }

      .wrapper {
       width: 100%;
       max-width: 375px;
       margin: 0 auto;
       padding: 0 8px;  /* ← スマホでも左右余白があるように */
       box-sizing: border-box;
    }
       .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(18, 28px);
      gap: 4px;
      margin-bottom: 0;
      overflow: hidden;
    }

    .box {
      background: #fff;
      padding: 8px;
      border-radius: 8px;
      font-size: 12px;
      box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
    }

    .box h3 {
      margin: 4px 0 8px;
      font-size: 13px;
    }

    .row {
      margin: 8px 0;
    }

    .row label {
      display: block;
      margin-bottom: 4px;
      font-size: 13px;
    }

    .row input[type="number"] {
      width: 80px;
      height: 24px;
      text-align: center;
      border: 1px solid #333;
      border-radius: 4px;
      font-size: 13px;
    }

    /* 色分け */
    .green { background: #dff3e0; }
    .yellow { background: #fdf8c6; }
    .blue { background: #cce7f9; }
    .pink { background: #f8d7f2; }
    .purple { background: #e5d4f5; }
    .orange { background: #ffe4b5; }

    </style>
</head>
<body>
  <div class="wrapper">
    
    <div class="grid">
      <!-- ボーナス・小役 -->
      <div class="box green" style="grid-row: span 16;">
        <h3>Bonus小役</h3>
        <div class="row"><label>総G数</label><input type="number"></div>
        <div class="row"><label>BIG</label><input type="number"></div>
        <div class="row"><label>REG</label><input type="number"></div>
        <div class="row"><label>ベルA</label><input type="number"></div>
        <div class="row"><label>ベルB</label><input type="number"></div>
        <div class="row"><label>スイカA</label><input type="number"></div>
        <div class="row"><label>チェリーB</label><input type="number"></div>
      </div>

      <!-- BIG中 -->
<div class="box yellow" style="grid-row: span 9;">
  <h3>BIG中</h3>
  <div class="row"><label>総G数</label><input id="bigTotal" type="number"></div>
  <div class="row"><label>角チェベル</label><input id="kakubell" type="number"></div>
  <div class="row"><label>角チェ</label><input id="kakuke" type="number"></div>
  <div class="row"><label>中段チェ</label><input id="chudan" type="number"></div>
</div>

      <!-- REG中 -->
      <div class="box blue" style="grid-row: span 9;">
        <h3>REG中</h3>
        <div class="row"><label>総G数</label><input type="number"></div>
        <div class="row"><label>一枚役</label><input type="number"></div>
        <div class="row"><label>ハズレ</label><input type="number"></div>
      </div>

      <!-- VC中 -->
      <div class="box pink" style="grid-row: span 7;">
        <h3>VC中</h3>
        <div class="row"><label>総G数</label><input type="number"></div>
        <div class="row"><label>通常リプ</label><input type="number"></div>
        <div class="row"><label>ハズレ</label><input type="number"></div>
      </div>

      <!-- VG中 -->
      <div class="box purple" style="grid-row: span 7;">
        <h3>VG中</h3>
        <div class="row"><label>総G数</label><input type="number"></div>
        <div class="row"><label>RTリプ</label><input type="number"></div>
        <div class="row"><label>ハズレ</label><input type="number"></div>
      </div>
    </div>

   <!-- REG終了画面（左右分割スタイル） -->
<div class="box orange" style="margin-top: 0; padding: 8px;">
  <div style="display: flex; gap: 8px;">
    
    <!-- 左側：入力欄 -->
    <div style="flex: 1;">
      <div class="row" style="display: flex; align-items: center; gap: 4px; margin-bottom: 6px;">
        <h3 style="margin: 0; font-size: 13px;">REG画面</h3>
        <label style="font-size: 13px; display: flex; align-items: center; gap: 4px;">
          <input type="checkbox" id="regEndCheck"> 赤帯出現
        </label>
      </div>
      <div class="row" style="display: flex; align-items: center; gap: 6px;"><input type="number" style="width: 60px;"><span>1/128</span></div>
      <div class="row" style="display: flex; align-items: center; gap: 6px;"><input type="number" style="width: 60px;"><span>1/32</span></div>
      <div class="row" style="display: flex; align-items: center; gap: 6px;"><input type="number" style="width: 60px;"><span>1/16</span></div>
      <div class="row" style="display: flex; align-items: center; gap: 6px;"><input type="number" style="width: 60px;"><span>1/8</span></div>
      <div class="row" style="display: flex; align-items: center; gap: 6px;"><input type="number" style="width: 60px;"><span>1/5.2</span></div>
      <div class="row" style="display: flex; align-items: center; gap: 6px;"><input type="number" style="width: 60px;"><span>1/4</span></div>
      <div class="row" style="display: flex; align-items: center; gap: 6px;"><input type="number" style="width: 60px;"><span>1/2</span></div>
    </div>

   <!-- 右側：注意書き＋表（縦に並べて下詰め） -->
<div style="flex: 1; display: flex; flex-direction: column; justify-content: flex-end;">
  <div style="font-size: 10px; line-height: 1.4; margin-bottom: 4px;">
    <p style="margin: 2px 0;">※赤帯出現時はチェックボックスにチェックを入れてください。</p>
    <p style="margin: 2px 0;">※チェックを入れた場合はREG回数の入力は不要です。</p>
    <p style="margin: 2px 0;">
      ※赤帯が出現していない場合、下記の表を参考に <strong>赤帯が出なかった REG</strong> の回数を入力してください。
    </p>
  </div>

  <table style="font-size: 10px; width: 100%; border-collapse: collapse; text-align: center;">
    <thead>
      <tr style="background: #f5f5f5;">
        <th style="border: 1px solid #ccc; padding: 2px;">１枚役＼RT連</th>
        <th style="border: 1px solid #ccc; padding: 2px;">無</th>
        <th style="border: 1px solid #ccc; padding: 2px;">2</th>
        <th style="border: 1px solid #ccc; padding: 2px;">3+</th>
      </tr>
    </thead>
    <tbody>
      <tr><td style="border: 1px solid #ccc;">1回以下</td><td>1/128</td><td>1/32</td><td>1/16</td></tr>
      <tr><td style="border: 1px solid #ccc;">2回</td><td>1/32</td><td>1/16</td><td>1/8</td></tr>
      <tr><td style="border: 1px solid #ccc;">3回</td><td>1/16</td><td>1/8</td><td>1/5.2</td></tr>
      <tr><td style="border: 1px solid #ccc;">4回</td><td>1/8</td><td>1/4</td><td>1/4</td></tr>
      <tr><td style="border: 1px solid #ccc;">5回以上</td><td>1/4</td><td>1/2</td><td><strong>1/2</strong></td></tr>
    </tbody>
  </table>
</div>

  </div>
</div>

<!-- 判別ボタン -->
<div style="margin-top: 24px;">
  <button onclick="showResult()" style="font-size: 16px; padding: 8px 16px;">判別する</button>
</div>

<!-- 判別結果表示エリア -->
<div id="resultArea" style="display: none; margin-top: 20px;">
  <!-- 判別結果表 -->
  <table style="font-size: 12px; width: 100%; border-collapse: collapse; margin-bottom: 16px;">
    <thead>
      <tr style="background: #eee;">
        <th style="border: 1px solid #ccc; padding: 4px;">設定＼区間</th>
        <th style="border: 1px solid #ccc; padding: 4px;"><strong>総合評価</strong></th>
        <th style="border: 1px solid #ccc; padding: 4px;">ボーナス小役</th>
        <th style="border: 1px solid #ccc; padding: 4px;">BIG中</th>
        <th style="border: 1px solid #ccc; padding: 4px;">REG中</th>
        <th style="border: 1px solid #ccc; padding: 4px;">VC中</th>
        <th style="border: 1px solid #ccc; padding: 4px;">VG中</th>
        <th style="border: 1px solid #ccc; padding: 4px;">REG画面</th>
      </tr>
    </thead>
    <tbody>
      <tr><td style="border: 1px solid #ccc;">設定1</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td></tr>
      <tr><td style="border: 1px solid #ccc;">設定2</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td></tr>
      <tr><td style="border: 1px solid #ccc;">設定5</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td></tr>
      <tr><td style="border: 1px solid #ccc;">設定6</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td><td>--%</td></tr>
    </tbody>
  </table>

  <!-- 判別結果下の入力フォーム -->
  <div style="margin-top: 20px;">
  <div style="display: flex; flex-wrap: wrap; gap: 8px;">
    <div style="flex: 1 1 100px;">
      <label style="font-size: 13px;">日付</label>
      <input type="date" style="width: 100%;">
    </div>
    <div style="flex: 1 1 100px;">
      <label style="font-size: 13px;">台番</label>
      <input type="text" style="width: 100%;">
    </div>
    <div style="flex: 1 1 100px;">
      <label style="font-size: 13px;">店舗名</label>
      <input type="text" style="width: 100%;">
    </div>
  </div>

  <div style="margin-top: 12px;">
    <label style="font-size: 13px;">メモ</label><br>
    <textarea rows="3" style="width: 100%; font-size: 13px;"></textarea>
  </div>

  <div style="margin-top: 12px; text-align: left;">
    <button style="font-size: 14px;">📸 スクリーンショットを生成</button>
  </div>
</div>

<script>
  function logFact(n) {
    if (n === 0 || n === 1) return 0;
    let res = 0;
    for (let i = 2; i <= n; i++) res += Math.log(i);
    return res;
  }

  function binomialLogP(k, n, p) {
    if (k > n || p <= 0 || p >= 1) return -Infinity;
    return logFact(n) - logFact(k) - logFact(n - k) + k * Math.log(p) + (n - k) * Math.log(1 - p);
  }

  function showResult() {
    document.getElementById("resultArea").style.display = "block";

    // 🟡 BIG中の判別処理
    const bigTotal = parseInt(document.getElementById("bigTotal").value || 0);
    const kakubell = parseInt(document.getElementById("kakubell").value || 0);
    const kakuke   = parseInt(document.getElementById("kakuke").value || 0);
    const chudan   = parseInt(document.getElementById("chudan").value || 0);

    const rates = {
      kakubell: [1/11.1, 1/8.9, 1/11.1, 1/8.9],
      kakuke:   [1/256.0, 1/128.0, 1/256.0, 1/128.0],
      chudan:   [1/16384, 1/16384, 1/16384, 1/897.8],
    };

    const logs = [0, 0, 0, 0];
    const keys = ['kakubell', 'kakuke', 'chudan'];
    const counts = [kakubell, kakuke, chudan];

    keys.forEach((key, i) => {
      for (let s = 0; s < 4; s++) {
        logs[s] += binomialLogP(counts[i], bigTotal, rates[key][s]);
      }
    });

    // 正規化して%化
    const maxLog = Math.max(...logs);
    const expLogs = logs.map(l => Math.exp(l - maxLog));
    const total = expLogs.reduce((a, b) => a + b);
    const percents = expLogs.map(v => (v / total * 100).toFixed(2) + "%");

    // 表に反映（BIG中列: 3列目 = index 3）
    const rows = document.querySelectorAll("#resultArea tbody tr");
    rows.forEach((tr, i) => {
      tr.children[3].innerText = percents[i]; // 3列目がBIG中
    });

    // 日付の初期値設定（1回だけで良い処理）
    const dateField = document.getElementById("dateInput");
    if (dateField && !dateField.value) {
      const today = new Date().toISOString().split("T")[0];
      dateField.value = today;
    }
  }
</script>
  </div>

  <div style="text-align: center; margin-top: 20px;">
  <a href="index.html">＜ 機種選択に戻る</a>
</div>
  </div>

</body>
</html>